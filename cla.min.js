function adjustColorLevel(u,v){function g(){for(var b=function(a){var b=document.createElement("canvas");b.width=a.width;b.height=a.height;b=b.getContext("2d");b.drawImage(a,0,0,a.width,a.height);return b.getImageData(0,0,a.width,a.height)}(u),h=new ImageData(b.width,b.height),f=0,n=255,p=0,e=255,g=0,d=255,q=Array(256),r=Array(256),t=Array(256),a=0;256>a;a++)q[a]=0,r[a]=0,t[a]=0;for(var c=b.width*b.height*4,a=0;a<c;a+=4)q[b.data[a]]++,r[b.data[a+1]]++,t[b.data[a+2]]++;for(var c=c/4,k=!1,l=!1,m=!1,
a=0;192>a;a++)k||(f=a),l||(p=a),m||(g=a),q[a]>1E-4*c&&(k=!0),r[a]>1E-4*c&&(l=!0),t[a]>1E-4*c&&(m=!0);m=l=k=!1;for(a=255;63<a;a--)k||(n=a),l||(e=a),m||(d=a),q[a]>1E-4*c&&(k=!0),r[a]>1E-4*c&&(l=!0),t[a]>1E-4*c&&(m=!0);f=Math.min(f,p,g);a=Math.max(n,e,d);n=100*(f+255-a)/255;e=new Uint8Array(256);p=a-f;for(a=0;256>a;a++)d=Math.floor(255*(a-f)/p),0>d&&(d=0),255<d&&(d=255),e[a]=Math.floor(d);c=b.width*b.height*4;for(a=0;a<c;a+=4)h.data[a]=e[b.data[a]],h.data[a+1]=e[b.data[a+1]],h.data[a+2]=e[b.data[a+2]],
h.data[a+3]=b.data[a+3];v(function(a){var b=new Image,c=document.createElement("canvas");c.width=a.width;c.height=a.height;c.getContext("2d").putImageData(a,0,0);b.src=c.toDataURL("image/png");return b}(h),n)}0==u.naturalHeight?u.onload=g:g()};
